{"version":3,"sources":["http.js"],"names":[],"mappings":"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","file":"http-compiled.js","sourcesContent":["/**\n * Created by qizhang on 5/4/16.\n * http请求工具函数\n */\nimport $ from 'jquery'\nimport Q from 'q'\nimport appConfig from '../config'\nimport auth from '../auth'\n$.support.cors = true;\n\nlet ERROR_CODE = {\n    'login': {\n        '-4': '用户名或者密码错误',\n        '-3': '没有找到此用户',\n        '-5': '请输入合法的用户名或者密码'\n    },\n    'postExamGroup': {\n        '-5': '成绩导入失败',\n        '-6': '已存在此考试成绩',\n        '-7': '你没有权限对该班级进行操作',\n        '-12': '班级或成绩文件不存在'\n    },\n    'default': {\n        '-3': '未找到数据',\n        '-5': '参数不正确',\n        '-6': '数据重复',\n        '-7': '你没有执行此操作的权限',\n        '-12': '你操作的对象不存在',\n        '-14': '服务器返回了一个IO错误',\n        '401': '你没有执行此操作的权限,请确定你是否是管理员，或者身份信息已过期，请重新登录',\n        '404': '你访问的资源不存在（404）',\n        '500': '服务器返回了一个错误',\n        '-255': '服务器返回了一个错误',\n        '-15': '你的账号已经在别处登录,请重新登录',\n        '0': '请求失败,请检查网络'\n    }\n};\n\nexport const getErrorMsg = function (code, type) {\n    code = code.toString();\n    if (!type || !ERROR_CODE[type]) {\n        return ERROR_CODE['default'][code] || `未知错误:${code}`;\n    }\n    if (ERROR_CODE[type][code]) {\n        return ERROR_CODE[type][code];\n    }\n    else {\n        return ERROR_CODE['default'][code] || `未知错误:${code}`;\n    }\n}\n\nvar http = function (url, config, type) {\n    type = type || 'default';\n    if (typeof url === 'string') {\n        if (typeof config === 'string') {\n            type = config;\n            config = {\n                url: url\n            };\n        }\n        else if (typeof config === 'object') {\n            config.url = url;\n        }\n        else {\n            config = {\n                url: url\n            };\n        }\n    }\n    else {\n        type = config;\n        config = url;\n    }\n    if (!config.headers) {\n        config.headers = {};\n    }\n\n    config.headers.Authorization = auth.getToken() ? `CAuth ${auth.getToken()}` : '';\n    config.url = `${appConfig.apiHost}${config.url}`;\n    config.cache = false;\n    let deferred = Q.defer();\n    let ajax = $.ajax(config)\n        .done(function (res) {\n            if (res.State >= 0) {\n                deferred.resolve(res);\n            }\n            else {\n                deferred.reject({\n                    code: res.State,\n                    msg: getErrorMsg(res.State, type)\n                });\n            }\n        })\n        .fail(function (error) {\n            if (error.statusText === 'abort') {\n                deferred.reject({\n                    code: error.status,\n                    abort: true\n                });\n            }\n            else {\n                deferred.reject({\n                    code: error.status,\n                    msg: getErrorMsg(error.status, type)\n                });\n            }\n        });\n    return {\n        request: ajax,\n        promise: deferred.promise\n    }\n};\n\nexport default http\n\n"]}