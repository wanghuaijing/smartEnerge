{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAMA;;AACA;;;;;;AAPA;;;;;;AASO,IAAM,gCAAY,UAAlB;AACA,IAAM,8BAAW,SAAjB;;AAEP,IAAI,OAAO;AACP;;;;;;AAMA,aAPO,qBAOG,KAPH,EAOU,GAPV,EAOe,EAPf,EAOkB;AACrB,YAAI,OAAO;AACP,oBAAQ,GADD;AAEP,sBAAU,CAFH;AAGP,kBAAM;AAHC,SAAX;AAKA;AACA,YAAI,UAAU,IAAV,CAAe,KAAf,CAAJ,EAA2B;AACvB,mBAAO,MAAP,CAAc,IAAd,EAAoB;AAChB,2BAAW,CADK;AAEhB,uBAAO;AAFS,aAApB;AAIH;AACD;AANA,aAOK,IAAG,8BAA8B,IAA9B,CAAmC,KAAnC,CAAH,EAA8C;AAC/C,uBAAO,MAAP,CAAc,IAAd,EAAoB;AAChB,+BAAW,CADK;AAEhB,2BAAO;AAFS,iBAApB;AAIH,aALI,MAMD;AACA,uBAAO,MAAP,CAAc,IAAd,EAAoB;AAChB,+BAAW,CADK;AAEhB,0BAAM;AAFU,iBAApB;AAIH;;AAGD,yBAAK;AACD,kBAAM,MADL;AAED,iBAAK,8BAFJ;AAGD,kBAAM;AAHL,SAAL,EAIG,OAJH,CAKK,IALL,CAKU,UAAC,GAAD,EAAS;AACX,gBAAI,OAAO,IAAI,IAAf;AACA,4BAAM,GAAN,CAAU,SAAV,EAAqB,KAAK,KAA1B;AACA,4BAAM,GAAN,CAAU,QAAV,EAAoB,KAAK,KAAL,CAAW,QAA/B;AACA,eAAG,IAAH,EAAS,IAAT;AACH,SAVL,EAWK,KAXL,CAWW,UAAC,GAAD,EAAQ;AACX,eAAG,GAAH;AACH,SAbL;AAcH,KAjDM;;;AAmDP;;;AAGA,gBAtDO,0BAsDO;AACV,YAAI,gBAAM,GAAN,CAAU,SAAV,CAAJ,EAA0B;AACtB,mBAAO,IAAP;AACH,SAFD,MAII,OAAO,KAAP;AACP,KA5DM;;;AA8DP;;;AAGA,eAjEO,uBAiEK,EAjEL,EAiEQ;AACX,wBAAM,MAAN,CAAa,SAAb;AACA,wBAAM,MAAN,CAAa,QAAb;AACA;AACH,KArEM;;;AAuEP;;;;AAIA,YA3EO,sBA2EG;AACN,eAAO,gBAAM,GAAN,CAAU,SAAV,CAAP;AACH,KA7EM;;;AA+EP;;;;AAIA,WAnFO,qBAmFE;AACL,eAAO,gBAAM,GAAN,CAAU,QAAV,KAAuB,EAA9B;AAEH;AAtFM,CAAX;;kBAyFe,I","file":"index-compiled.js","sourcesContent":["/**\r\n * 创建于：6/1/16\r\n * 创建人：杨骐彰\r\n * 说明：登录验证模块\r\n */\r\n\r\nimport {http} from 'utils'\r\nimport store from 'store'\r\n\r\nexport const TOKEN_KEY = 'ef_token';\r\nexport const USER_KEY = 'ef_user';\r\n\r\nvar Auth = {\r\n    /**\r\n     * 登录\r\n     * @param uname\r\n     * @param psd\r\n     * @param cb\r\n     */\r\n    authorize(uname, psd, cb){\r\n        let data = {\r\n            CurPwd: psd,\r\n            ClientId: 3,\r\n            Role: 0\r\n        };\r\n        //电话登录\r\n        if (/^\\d*$/gi.test(uname)) {\r\n            Object.assign(data, {\r\n                LoginType: 2,\r\n                Phone: uname\r\n            })\r\n        }\r\n        //邮箱登录\r\n        else if(/[^@\\.]+@[^@\\.]+\\.[^@\\.]+$/gi.test(uname)) {\r\n            Object.assign(data, {\r\n                LoginType: 3,\r\n                Email: uname\r\n            })\r\n        }\r\n        else{\r\n            Object.assign(data, {\r\n                LoginType: 1,\r\n                Name: uname\r\n            })\r\n        }\r\n\r\n\r\n        http({\r\n            type: 'post',\r\n            url: '/Account/Login?misc=UserInfo',\r\n            data: data\r\n        }).promise\r\n            .then((res) => {\r\n                let data = res.Data;\r\n                store.set(TOKEN_KEY, data.Token);\r\n                store.set(USER_KEY, data.Extra.UserInfo);\r\n                cb(null, data);\r\n            })\r\n            .catch((err)=> {\r\n                cb(err);\r\n            });\r\n    },\r\n\r\n    /**\r\n     * 是否已登录\r\n     */\r\n    isAuthorized(){\r\n        if (store.get(TOKEN_KEY)) {\r\n            return true;\r\n        }\r\n        else\r\n            return false;\r\n    },\r\n\r\n    /**\r\n     * 退出登录\r\n     */\r\n    unAuthorize(cb){\r\n        store.remove(TOKEN_KEY);\r\n        store.remove(USER_KEY);\r\n        cb();\r\n    },\r\n\r\n    /**\r\n     * 获取token\r\n     * @returns {*}\r\n     */\r\n    getToken(){\r\n        return store.get(TOKEN_KEY);\r\n    },\r\n\r\n    /**\r\n     * 获取用户信息\r\n     * @returns {*|{}}\r\n     */\r\n    getUser(){\r\n        return store.get(USER_KEY) || {};\r\n\r\n    }\r\n};\r\n\r\nexport default Auth;"]}